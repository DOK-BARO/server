<?xml version="1.0" encoding="UTF-8"?>
<configuration>
	<property name="LOG_PATTERN" value="[%d{yyyy-MM-dd HH:mm:ss}:%-3relative][%thread] %-5level %logger{36} - %msg%n"/>
	<appender name="LOKI" class="com.github.loki4j.logback.Loki4jAppender">
		<http>
			<url>http://loki:3100/loki/api/v1/push</url>
		</http>

		<format>
			<label>
				<apttern>
					app=${appName},host=${HOSTNAME}, traceID=%X{traceID: -NONE}. level=%$level
				</apttern>
			</label>
			<message>
				<pattern>${LOG_PATTERN}</pattern>
			</message>
			<sortByTime>true</sortByTime>
		</format>
	</appender>

	<appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
		<layout class="ch.qos.logback.classic.PatternLayout">
			<Pattern>${LOG_PATTERN}</Pattern>
		</layout>
	</appender>

	<springProfile name="local">
		<root level="INFO">
			<appender-ref ref="CONSOLE"/>
		</root>
	</springProfile>
	<springProfile name="dev">
		<root level="INFO">
			<appender-ref ref="CONSOLE"/>
			<appender-ref ref="LOKI"/>
		</root>
	</springProfile>
	<springProfile name="prod">
		<root level="INFO">
			<appender-ref ref="LOKI"/>
		</root>
	</springProfile>
</configuration>